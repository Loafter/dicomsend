package filereciversrv
import (
	"net/http"
	"strconv"
	"io/ioutil"
	"log"
	"encoding/base64"
	"crypto/rand"
	"fmt"
	"os"
	"dicomsend/http_receiver"
	"godownloader/monitor"
	"encoding/json"
)

const htmlData = "PAAhAGQAbwBjAHQAeQBwAGUAIABoAHQAbQBsAD4ADQAKAA0ACgA8AGgAdABtAGwAPgANAAoADQAKADwAaABlAGEAZAA+AA0ACgAgACAAIAAgADwAdABpAHQAbABlAD4ARABJAEMATwBNACAARABSAE8AUABCAE8AWAA8AC8AdABpAHQAbABlAD4ADQAKACAAIAAgACAAPABtAGUAdABhACAAbgBhAG0AZQA9ACIAdgBpAGUAdwBwAG8AcgB0ACIAIABjAG8AbgB0AGUAbgB0AD0AIgB3AGkAZAB0AGgAPQBkAGUAdgBpAGMAZQAtAHcAaQBkAHQAaAAiAD4ADQAKACAAIAAgACAAPABsAGkAbgBrACAAcgBlAGwAPQAiAHMAdAB5AGwAZQBzAGgAZQBlAHQAIgAgAGgAcgBlAGYAPQAiAGgAdAB0AHAAcwA6AC8ALwBuAGUAdABkAG4AYQAuAGIAbwBvAHQAcwB0AHIAYQBwAGMAZABuAC4AYwBvAG0ALwBiAG8AbwB0AHMAdwBhAHQAYwBoAC8AMwAuADAALgAwAC8AagBvAHUAcgBuAGEAbAAvAGIAbwBvAHQAcwB0AHIAYQBwAC4AbQBpAG4ALgBjAHMAcwAiAD4ADQAKACAAIAAgACAAPABsAGkAbgBrACAAcgBlAGwAPQAiAHMAdAB5AGwAZQBzAGgAZQBlAHQAIgAgAHQAeQBwAGUAPQAiAHQAZQB4AHQALwBjAHMAcwAiACAAbQBlAGQAaQBhAD0AIgBzAGMAcgBlAGUAbgAiAA0ACgAgACAAIAAgACAAIAAgACAAIAAgAGgAcgBlAGYAPQAiAGgAdAB0AHAAOgAvAC8AdwB3AHcALgBnAHUAcgBpAGQAZABvAC4AbgBlAHQALwBkAGUAbQBvAC8AYwBzAHMALwB0AHIAaQByAGEAbgBkAC8AdQBpAC4AagBxAGcAcgBpAGQALQBiAG8AbwB0AHMAdAByAGEAcAAuAGMAcwBzACIAPgANAAoAIAAgACAAIAA8AHMAYwByAGkAcAB0ACAAdAB5AHAAZQA9ACIAdABlAHgAdAAvAGoAYQB2AGEAcwBjAHIAaQBwAHQAIgAgAHMAcgBjAD0AIgBoAHQAdABwAHMAOgAvAC8AYQBqAGEAeAAuAGcAbwBvAGcAbABlAGEAcABpAHMALgBjAG8AbQAvAGEAagBhAHgALwBsAGkAYgBzAC8AagBxAHUAZQByAHkALwAyAC4AMAAuADMALwBqAHEAdQBlAHIAeQAuAG0AaQBuAC4AagBzACIAPgA8AC8AcwBjAHIAaQBwAHQAPgANAAoAIAAgACAAIAA8AHMAYwByAGkAcAB0ACAAdAB5AHAAZQA9ACIAdABlAHgAdAAvAGoAYQB2AGEAcwBjAHIAaQBwAHQAIgAgAHMAcgBjAD0AIgBoAHQAdABwAHMAOgAvAC8AbgBlAHQAZABuAGEALgBiAG8AbwB0AHMAdAByAGEAcABjAGQAbgAuAGMAbwBtAC8AYgBvAG8AdABzAHQAcgBhAHAALwAzAC4AMwAuADQALwBqAHMALwBiAG8AbwB0AHMAdAByAGEAcAAuAG0AaQBuAC4AagBzACIAPgA8AC8AcwBjAHIAaQBwAHQAPgANAAoAIAAgACAAIAA8AHMAYwByAGkAcAB0ACAAdAB5AHAAZQA9ACIAdABlAHgAdAAvAGoAYQB2AGEAcwBjAHIAaQBwAHQAIgAgAHMAcgBjAD0AIgBoAHQAdABwADoALwAvAHcAdwB3AC4AZwB1AHIAaQBkAGQAbwAuAG4AZQB0AC8AZABlAG0AbwAvAGoAcwAvAHQAcgBpAHIAYQBuAGQALwBqAHEAdQBlAHIAeQAuAGoAcQBHAHIAaQBkAC4AbQBpAG4ALgBqAHMAIgA+ADwALwBzAGMAcgBpAHAAdAA+AA0ACgAgACAAIAAgADwAcwBjAHIAaQBwAHQAIAB0AHkAcABlAD0AIgB0AGUAeAB0AC8AagBhAHYAYQBzAGMAcgBpAHAAdAAiACAAcwByAGMAPQAiAGgAdAB0AHAAOgAvAC8AdwB3AHcALgBnAHUAcgBpAGQAZABvAC4AbgBlAHQALwBkAGUAbQBvAC8AagBzAC8AdAByAGkAcgBhAG4AZAAvAGkAMQA4AG4ALwBnAHIAaQBkAC4AbABvAGMAYQBsAGUALQBlAG4ALgBqAHMAIgA+ADwALwBzAGMAcgBpAHAAdAA+AA0ACgAgACAAIAAgADwAbABpAG4AawAgAHIAZQBsAD0AIgBzAHQAeQBsAGUAcwBoAGUAZQB0ACIAIABoAHIAZQBmAD0AIgAvAC8AYwBvAGQAZQAuAGoAcQB1AGUAcgB5AC4AYwBvAG0ALwB1AGkALwAxAC4AMQAxAC4ANAAvAHQAaABlAG0AZQBzAC8AcwBtAG8AbwB0AGgAbgBlAHMAcwAvAGoAcQB1AGUAcgB5AC0AdQBpAC4AYwBzAHMAIgA+AA0ACgAgACAAIAAgADwAcwBjAHIAaQBwAHQAIABzAHIAYwA9ACIAaAB0AHQAcAA6AC8ALwBjAG8AZABlAC4AagBxAHUAZQByAHkALgBjAG8AbQAvAHUAaQAvADEALgAxADEALgA0AC8AagBxAHUAZQByAHkALQB1AGkALgBqAHMAIgA+ADwALwBzAGMAcgBpAHAAdAA+AA0ACgAgACAAIAAgADwAcwB0AHkAbABlACAAYwBsAGEAcwBzAD0AIgBjAHAALQBwAGUAbgAtAHMAdAB5AGwAZQBzACIAPgANAAoAIAAgACAAIAAgACAAIAAgACMAZAByAG8AcAB6AG8AbgBlACAAewANAAoAIAAgACAAIAAgACAAIAAgAHAAbwBzAGkAdABpAG8AbgA6ACAAcgBlAGwAYQB0AGkAdgBlADsADQAKACAAIAAgACAAIAAgACAAIABiAG8AcgBkAGUAcgA6ACAAMQAwAHAAeAAgAGQAbwB0AHQAZQBkACAAZwByAGUAeQA7AA0ACgAgACAAIAAgACAAIAAgACAAYgBvAHIAZABlAHIALQByAGEAZABpAHUAcwA6ACAAMgAwAHAAeAA7AA0ACgAgACAAIAAgACAAIAAgACAAYwBvAGwAbwByADoAIABnAHIAZQB5ADsADQAKACAAIAAgACAAIAAgACAAIABmAG8AbgB0ADoAIABiAG8AbABkACAAMgA0AHAAeAAvADIAMAAwAHAAeAAgAGEAcgBpAGEAbAA7AA0ACgAgACAAIAAgACAAIAAgACAAaABlAGkAZwBoAHQAOgAgADIANQAwAHAAeAA7AA0ACgAgACAAIAAgACAAIAAgACAAbQBhAHIAZwBpAG4AOgAgADMAMABwAHgAIABhAHUAdABvADsADQAKACAAIAAgACAAIAAgACAAIAB0AGUAeAB0AC0AYQBsAGkAZwBuADoAIABjAGUAbgB0AGUAcgA7AA0ACgAgACAAIAAgACAAIAAgACAAdwBpAGQAdABoADoAIAA4ADAAMABwAHgAOwANAAoAIAAgACAAIAAgACAAIAAgAH0ADQAKAA0ACgAgACAAIAAgACAAIAAgACAAIwBkAHIAbwBwAHoAbwBuAGUALgBoAG8AdgBlAHIAIAB7AA0ACgAgACAAIAAgACAAIAAgACAAYgBvAHIAZABlAHIAOgAgADEAMABwAHgAIABzAG8AbABpAGQAIAAjAEYARQA1ADsADQAKACAAIAAgACAAIAAgACAAIABjAG8AbABvAHIAOgAgACMARgBFADUAOwANAAoAIAAgACAAIAAgACAAIAAgAH0ADQAKAA0ACgAgACAAIAAgACAAIAAgACAAIwBkAHIAbwBwAHoAbwBuAGUALgBkAHIAbwBwAHAAZQBkACAAewANAAoAIAAgACAAIAAgACAAIAAgAGIAYQBjAGsAZwByAG8AdQBuAGQAOgAgACMAMgAyADIAOwANAAoAIAAgACAAIAAgACAAIAAgAGIAbwByAGQAZQByADoAIAAxADAAcAB4ACAAcwBvAGwAaQBkACAAIwA0ADQANAA7AA0ACgAgACAAIAAgACAAIAAgACAAfQANAAoADQAKACAAIAAgACAAIAAgACAAIAAjAGQAcgBvAHAAegBvAG4AZQAgAGQAaQB2ACAAewANAAoAIAAgACAAIAAgACAAIAAgAHAAbwBzAGkAdABpAG8AbgA6ACAAYQBiAHMAbwBsAHUAdABlADsADQAKACAAIAAgACAAIAAgACAAIAB0AG8AcAA6ACAAMAA7AA0ACgAgACAAIAAgACAAIAAgACAAcgBpAGcAaAB0ADoAIAAwADsADQAKACAAIAAgACAAIAAgACAAIABiAG8AdAB0AG8AbQA6ACAAMAA7AA0ACgAgACAAIAAgACAAIAAgACAAbABlAGYAdAA6ACAAMAA7AA0ACgAgACAAIAAgACAAIAAgACAAfQANAAoADQAKACAAIAAgACAAIAAgACAAIAAjAGQAcgBvAHAAegBvAG4AZQAgAFsAdAB5AHAAZQA9ACIAZgBpAGwAZQAiAF0AIAB7AA0ACgAgACAAIAAgACAAIAAgACAAYwB1AHIAcwBvAHIAOgAgAHAAbwBpAG4AdABlAHIAOwANAAoAIAAgACAAIAAgACAAIAAgAHAAbwBzAGkAdABpAG8AbgA6ACAAYQBiAHMAbwBsAHUAdABlADsADQAKACAAIAAgACAAIAAgACAAIABvAHAAYQBjAGkAdAB5ADoAIAAwADsADQAKACAAIAAgACAAIAAgACAAIAB0AG8AcAA6ACAAMAA7AA0ACgAgACAAIAAgACAAIAAgACAAcgBpAGcAaAB0ADoAIAAwADsADQAKACAAIAAgACAAIAAgACAAIABiAG8AdAB0AG8AbQA6ACAAMAA7AA0ACgAgACAAIAAgACAAIAAgACAAbABlAGYAdAA6ACAAMAA7AA0ACgAgACAAIAAgACAAIAAgACAAfQANAAoAIAAgACAAIAA8AC8AcwB0AHkAbABlAD4ADQAKACAAIAAgACAAPABzAHQAeQBsAGUAIAB0AHkAcABlAD0AIgB0AGUAeAB0AC8AYwBzAHMAIgA+AA0ACgAgACAAIAAgACAAIAAgACAAYgBvAGQAeQAgAHsADQAKACAAIAAgACAAIAAgACAAIABwAGEAZABkAGkAbgBnAC0AdABvAHAAOgAgADUAMABwAHgAOwANAAoAIAAgACAAIAAgACAAIAAgAHAAYQBkAGQAaQBuAGcALQBiAG8AdAB0AG8AbQA6ACAAMgAwAHAAeAA7AA0ACgAgACAAIAAgACAAIAAgACAAfQANAAoADQAKACAAIAAgACAAIAAgACAAIAAuAHQAYQBiAGwAZQAgAC4AcAByAG8AZwByAGUAcwBzACAAewANAAoAIAAgACAAIAAgACAAIAAgAG0AYQByAGcAaQBuAC0AYgBvAHQAdABvAG0AOgAgADAAcAB4ADsADQAKACAAIAAgACAAIAAgACAAIAB9AA0ACgAgACAAIAAgADwALwBzAHQAeQBsAGUAPgANAAoAIAAgACAAIAA8AHMAYwByAGkAcAB0ACAAcwByAGMAPQAnAC8ALwBhAHMAcwBlAHQAcwAuAGMAbwBkAGUAcABlAG4ALgBpAG8ALwBhAHMAcwBlAHQAcwAvAGMAbwBtAG0AbwBuAC8AcwB0AG8AcABFAHgAZQBjAHUAdABpAG8AbgBPAG4AVABpAG0AZQBvAHUAdAAuAGoAcwA/AHQAPQAxACcAPgA8AC8AcwBjAHIAaQBwAHQAPgANAAoADQAKACAAIAAgACAAPABzAGMAcgBpAHAAdAA+AA0ACgAJAAkAJAAoAGYAdQBuAGMAdABpAG8AbgAoACkAIAB7AA0ACgAJAAkACQAkACgAJwAjAGQAcgBvAHAAegBvAG4AZQAnACkALgBvAG4AKAAnAGQAcgBhAGcAbwB2AGUAcgAnACwAIABmAHUAbgBjAHQAaQBvAG4AKAApACAAewANAAoACQAJAAkACQAkACgAdABoAGkAcwApAC4AYQBkAGQAQwBsAGEAcwBzACgAJwBoAG8AdgBlAHIAJwApADsADQAKAAkACQAJAH0AKQA7AA0ACgAJAAkACQAkACgAJwAjAGQAcgBvAHAAegBvAG4AZQAnACkALgBvAG4AKAAnAGQAcgBhAGcAbABlAGEAdgBlACcALAAgAGYAdQBuAGMAdABpAG8AbgAoACkAIAB7AA0ACgAJAAkACQAJACQAKAB0AGgAaQBzACkALgByAGUAbQBvAHYAZQBDAGwAYQBzAHMAKAAnAGgAbwB2AGUAcgAnACkAOwANAAoACQAJAAkAfQApADsADQAKAA0ACgANAAoACQAJAAkAJAAoACIAZgBvAHIAbQAjAGYAbwByAG0AXwBkAGEAdABhAF8AaQBkACIAKQAuAHMAdQBiAG0AaQB0ACgAZgB1AG4AYwB0AGkAbwBuACgAZQB2AGUAbgB0ACkAIAB7AA0ACgAJAAkACQAJAC8ALwBkAGkAcwBhAGIAbABlACAAdABoAGUAIABkAGUAZgBhAHUAbAB0ACAAZgBvAHIAbQAgAHMAdQBiAG0AaQBzAHMAaQBvAG4ADQAKAAkACQAJAAkAZQB2AGUAbgB0AC4AcAByAGUAdgBlAG4AdABEAGUAZgBhAHUAbAB0ACgAKQA7AA0ACgAJAAkACQAJAC8ALwBnAHIAYQBiACAAYQBsAGwAIABmAG8AcgBtACAAZABhAHQAYQANAAoACQAJAAkACQB2AGEAcgAgAGYAbwByAG0ARABhAHQAYQAgAD0AIABuAGUAdwAgAEYAbwByAG0ARABhAHQAYQAoACQAKAB0AGgAaQBzACkAWwAwAF0AKQA7AA0ACgANAAoACQAJAAkACQAkAC4AYQBqAGEAeAAoAHsADQAKAAkACQAJAAkACQB1AHIAbAA6ACAAJwBoAHQAdABwADoALwAvACcAKwBsAG8AYwBhAHQAaQBvAG4ALgBoAG8AcwB0ACsAJwAvAHUAcABsAG8AYQBkAF8AZABpAGMAbwBtACcALAANAAoACQAJAAkACQAJAHQAeQBwAGUAOgAgACcAUABPAFMAVAAnACwADQAKAAkACQAJAAkACQBkAGEAdABhADoAIABmAG8AcgBtAEQAYQB0AGEALAANAAoACQAJAAkACQAJAGEAcwB5AG4AYwA6ACAAdAByAHUAZQAsAA0ACgAJAAkACQAJAAkAYwBhAGMAaABlADoAIABmAGEAbABzAGUALAANAAoACQAJAAkACQAJAGMAbwBuAHQAZQBuAHQAVAB5AHAAZQA6ACAAZgBhAGwAcwBlACwADQAKAAkACQAJAAkACQBwAHIAbwBjAGUAcwBzAEQAYQB0AGEAOgAgAGYAYQBsAHMAZQANAAoACQAJAAkACQB9ACkAOwANAAoADQAKAAkACQAJAAkAcgBlAHQAdQByAG4AIABmAGEAbABzAGUAOwANAAoACQAJAAkAfQApADsADQAKAA0ACgANAAoACQAJAAkAJAAoACcAIwBkAHIAbwBwAHoAbwBuAGUAIABpAG4AcAB1AHQAJwApAC4AbwBuACgAJwBjAGgAYQBuAGcAZQAnACwAIABmAHUAbgBjAHQAaQBvAG4AKABlACkAIAB7AA0ACgAJAAkACQAJACQAKAAnACMAZgBvAHIAbQBfAGQAYQB0AGEAXwBpAGQAJwApAC4AcwB1AGIAbQBpAHQAKAApAA0ACgAJAAkACQB9ACkAOwANAAoACQAJAH0AKQA7AA0ACgANAAoAIAAgACAAIAA8AC8AcwBjAHIAaQBwAHQAPgANAAoAIAAgACAAIAA8AHMAYwByAGkAcAB0AD4ADQAKAAkACQBmAHUAbgBjAHQAaQBvAG4AIABVAHAAZABhAHQAZQBUAGEAYgBsAGUAKAApACAAewANAAoACQAJAAkAJAAoACIAIwBqAHEARwByAGkAZAAiACkALgBqAHEARwByAGkAZAAoAHsADQAKAAkACQAJAAkACQB1AHIAbAA6ACAAJwBoAHQAdABwADoALwAvACcAIAArACAAbABvAGMAYQB0AGkAbwBuAC4AaABvAHMAdABuAGEAbQBlACAAKwAgACcAOgA5ADkAOAAyAC8AcAByAG8AZwByAGUAcwBzAF8AdQBwAGwAbwBhAGQALgBqAHMAbwBuACcALAANAAoACQAJAAkACQAJAG0AdAB5AHAAZQA6ACAAIgBHAEUAVAAiACwADQAKAAkACQAJAAkACQBhAGoAYQB4AFMAdQBiAGcAcgBpAGQATwBwAHQAaQBvAG4AcwA6ACAAewANAAoACQAJAAkACQAJAAkAYQBzAHkAbgBjADoAIABmAGEAbABzAGUADQAKAAkACQAJAAkACQB9ACwADQAKAAkACQAJAAkACQBzAHQAeQBsAGUAVQBJADoAIAAnAEIAbwBvAHQAcwB0AHIAYQBwACcALAANAAoACQAJAAkACQAJAGQAYQB0AGEAdAB5AHAAZQA6ACAAIgBqAHMAbwBuACIALAANAAoACQAJAAkACQAJAGMAbwBsAE0AbwBkAGUAbAA6ACAAWwB7AA0ACgAJAAkACQAJAAkACQBsAGEAYgBlAGwAOgAgACcAJQAnACwADQAKAAkACQAJAAkACQAJAG4AYQBtAGUAOgAgACcAUAByAG8AZwByAGUAcwBzACcALAANAAoACQAJAAkACQAJAAkAdwBpAGQAdABoADoAIAAxADAADQAKAAkACQAJAAkACQB9ACwAewANAAoACQAJAAkACQAJAAkAbABhAGIAZQBsADoAIAAnAFAAcgBvAGcAcgBlAHMAcwAnACwADQAKAAkACQAJAAkACQAJAG4AYQBtAGUAOgAgACcAUAByAG8AZwByAGUAcwBzACcALAANAAoACQAJAAkACQAJAAkAZgBvAHIAbQBhAHQAdABlAHIAOgAgAEYAbwByAG0AYQB0AFAAcgBvAGcAcgBlAHMAcwBCAGEAcgANAAoACQAJAAkACQAJAH0ALAB7AA0ACgAJAAkACQAJAAkACQBsAGEAYgBlAGwAOgAgACcAVQBJAEQAJwAsAA0ACgAJAAkACQAJAAkACQBuAGEAbQBlADoAIAAnAFUAaQBkACcADQAKAAkACQAJAAkACQB9ACwAewANAAoACQAJAAkACQAJAAkAbABhAGIAZQBsADoAIAAnAFMAVABPAFAAJwAsAA0ACgAJAAkACQAJAAkACQBuAGEAbQBlADoAIAAnAFUAaQBkACcALAANAAoACQAJAAkACQAJAAkAZgBvAHIAbQBhAHQAdABlAHIAOgAgAEYAbwByAG0AYQB0AEQAZQBsAGwAQgB1AHQAdABvAG4ALAANAAoACQAJAAkACQAJAAkAdwBpAGQAdABoADoAIAAxADkALAANAAoACQAJAAkACQAJAH0ADQAKAAkACQAJAAkACQBdACwADQAKAAkACQAJAAkACQB2AGkAZQB3AHIAZQBjAG8AcgBkAHMAOgAgAHQAcgB1AGUALAANAAoACQAJAAkACQAJAHIAbwB3AE4AdQBtADoAIAA1ACwADQAKAAkACQAJAAkACQBwAGEAZwBlAHIAOgAgACIAIwBqAHEARwByAGkAZABQAGEAZwBlAHIAIgANAAoACQAJAAkACQB9ACkAOwANAAoACQAJAH0ADQAKAA0ACgAJAAkAZgB1AG4AYwB0AGkAbwBuACAARgBpAHgAVABhAGIAbABlACgAKQAgAHsADQAKAAkACQAJACQALgBlAHgAdABlAG4AZAAoACQALgBqAGcAcgBpAGQALgBhAGoAYQB4AE8AcAB0AGkAbwBuAHMALAAgAHsADQAKAAkACQAJAAkAYQBzAHkAbgBjADoAIABmAGEAbABzAGUADQAKAAkACQAJAH0AKQANAAoACQAJAAkAJAAoACIAIwBqAHEARwByAGkAZAAiACkADQAKAAkACQAJAAkALgBzAGUAdABHAHIAaQBkAFcAaQBkAHQAaAAoACQAKAB3AGkAbgBkAG8AdwApAA0ACgAJAAkACQAJAAkALgB3AGkAZAB0AGgAKAApACAALQAgADUAKQANAAoACQAJAAkAJAAoACIAIwBqAHEARwByAGkAZAAiACkADQAKAAkACQAJAAkALgBzAGUAdABHAHIAaQBkAEgAZQBpAGcAaAB0ACgAJAAoAHcAaQBuAGQAbwB3ACkADQAKAAkACQAJAAkACQAuAGgAZQBpAGcAaAB0ACgAKQApAA0ACgAJAAkACQAkACgAdwBpAG4AZABvAHcAKQANAAoACQAJAAkACQAuAGIAaQBuAGQAKAAnAHIAZQBzAGkAegBlACcALAAgAGYAdQBuAGMAdABpAG8AbgAoACkAIAB7AA0ACgAJAAkACQAJAAkAJAAoACIAIwBqAHEARwByAGkAZAAiACkADQAKAAkACQAJAAkACQAJAC4AcwBlAHQARwByAGkAZABXAGkAZAB0AGgAKAAkACgAdwBpAG4AZABvAHcAKQANAAoACQAJAAkACQAJAAkACQAuAHcAaQBkAHQAaAAoACkAIAAtACAANQApADsADQAKAAkACQAJAAkACQAkACgAIgAjAGoAcQBHAHIAaQBkACIAKQANAAoACQAJAAkACQAJAAkALgBzAGUAdABHAHIAaQBkAEgAZQBpAGcAaAB0ACgAJAAoAHcAaQBuAGQAbwB3ACkADQAKAAkACQAJAAkACQAJAAkALgBoAGUAaQBnAGgAdAAoACkAKQANAAoACQAJAAkACQB9ACkADQAKAAkACQB9AA0ACgANAAoADQAKACAAIAAgACAAIAAgACAAIABmAHUAbgBjAHQAaQBvAG4AIABkAGUAbABlAHQAZQBVAHAAKABlACkAIAB7AA0ACgAJAAkACQAkAC4AYQBqAGEAeAAoAHsADQAKAAkACQAJAAkAdQByAGwAOgAgACIAZABlAGwAZQB0AGUAXwB1AHAAbABvAGEAZAAiACwADQAKAAkACQAJAAkAdAB5AHAAZQA6ACAAIgBQAE8AUwBUACIALAANAAoACQAJAAkACQBkAGEAdABhADoAIABKAFMATwBOAC4AcwB0AHIAaQBuAGcAaQBmAHkAKABlAC4AaQBkACkALAANAAoACQAJAAkACQBkAGEAdABhAFQAeQBwAGUAOgAgACIAagBzAG8AbgAiACwADQAKAAkACQAJAH0AKQANAAoACQAJAH0ADQAKAA0ACgAJAAkAZgB1AG4AYwB0AGkAbwBuACAAVQBwAGQAYQB0AGUARABhAHQAYQAoACkAIAB7AA0ACgAJAAkACQB2AGEAcgAgAGcAcgBpAGQAIAA9ACAAJAAoACIAIwBqAHEARwByAGkAZAAiACkAOwANAAoACQAJAAkAdgBhAHIAIAByAG8AdwBLAGUAeQAgAD0AIABnAHIAaQBkAC4AagBxAEcAcgBpAGQAKAAnAGcAZQB0AEcAcgBpAGQAUABhAHIAYQBtACcALAAgACIAcwBlAGwAcgBvAHcAIgApADsADQAKAAkACQAJACQAKAAiACMAagBxAEcAcgBpAGQAIgApAC4AdAByAGkAZwBnAGUAcgAoACIAcgBlAGwAbwBhAGQARwByAGkAZAAiACkAOwANAAoACQAJAAkAaQBmACgAcgBvAHcASwBlAHkAKQAgAHsADQAKAAkACQAJAAkAJAAoACcAIwBqAHEARwByAGkAZAAnACkALgBqAHEARwByAGkAZAAoACIAcgBlAHMAZQB0AFMAZQBsAGUAYwB0AGkAbwBuACIAKQANAAoACQAJAAkACQAkACgAJwAjAGoAcQBHAHIAaQBkACcAKQAuAGoAcQBHAHIAaQBkACgAJwBzAGUAdABTAGUAbABlAGMAdABpAG8AbgAnACwAIAByAG8AdwBLAGUAeQApADsADQAKAAkACQAJAH0ADQAKAAkACQB9AA0ACgANAAoACQAJAGYAdQBuAGMAdABpAG8AbgAgAEYAbwByAG0AYQB0AFAAcgBvAGcAcgBlAHMAcwBCAGEAcgAoAGMAZQBsAGwAVgBhAGwAdQBlACwAIABvAHAAdABpAG8AbgBzACwAIAByAG8AdwBPAGIAagBlAGMAdAApACAAewANAAoACQAJAAkAdgBhAHIAIABpAG4AdABWAGEAbAAgAD0AIABwAGEAcgBzAGUASQBuAHQAKABjAGUAbABsAFYAYQBsAHUAZQApADsADQAKAAkACQAJAHYAYQByACAAYwBlAGwAbABIAHQAbQBsACAAPQAgACcAPABkAGkAdgAgAGMAbABhAHMAcwA9ACIAcAByAG8AZwByAGUAcwBzACIAPgA8AGQAaQB2ACAAYwBsAGEAcwBzAD0AIgBwAHIAbwBnAHIAZQBzAHMALQBiAGEAcgAiACAAcwB0AHkAbABlAD0AIgB3AGkAZAB0AGgAOgAgACcAIAArACAAaQBuAHQAVgBhAGwAIAArACAAJwAlADsAIgA+ADwALwBkAGkAdgA+ADwALwBkAGkAdgA+ACcADQAKAAkACQAJAHIAZQB0AHUAcgBuACAAYwBlAGwAbABIAHQAbQBsADsADQAKAAkACQB9AA0ACgANAAoACQAJAGYAdQBuAGMAdABpAG8AbgAgAEYAbwByAG0AYQB0AEQAZQBsAGwAQgB1AHQAdABvAG4AKABjAGUAbABsAFYAYQBsAHUAZQAsACAAbwBwAHQAaQBvAG4AcwAsACAAcgBvAHcATwBiAGoAZQBjAHQAKQAgAHsADQAKAAkACQAJAHYAYQByACAAaQBuAHQAVgBhAGwAIAA9ACAAcABhAHIAcwBlAEkAbgB0ACgAYwBlAGwAbABWAGEAbAB1AGUAKQA7AA0ACgAJAAkACQB2AGEAcgAgAGMAZQBsAGwASAB0AG0AbAAgAD0AIAAnADwAZABpAHYAIABjAGwAYQBzAHMAPQAiAGMAbwBuAHQAcgBvAGwAcwAiAD4APABhACAAIABvAG4AYwBsAGkAYwBrAD0AIgBkAGUAbABlAHQAZQBVAHAAKAB0AGgAaQBzACkAIgAgAGkAZAA9ACIAJwAgACAAKwAgAGMAZQBsAGwAVgBhAGwAdQBlACAAKwAgACcAIgAgAGMAbABhAHMAcwA9ACIAYgB0AG4AIABwAHUAbABsAC0AbABlAGYAdAAgAGIAdABuAC0AcwB1AGMAYwBlAHMAcwAgAGIAdABuAC0AeABzACIAPgBTAFQATwBQADwALwBhAD4APAAvAGQAaQB2AD4AJwANAAoACQAJAAkAcgBlAHQAdQByAG4AIABjAGUAbABsAEgAdABtAGwAOwANAAoACQAJAH0ADQAKAA0ACgAJAAkAZgB1AG4AYwB0AGkAbwBuACAATwBuAEwAbwBhAGQAKAApACAAewANAAoACQAJAAkAVQBwAGQAYQB0AGUAVABhAGIAbABlACgAKQANAAoACQAJAAkARgBpAHgAVABhAGIAbABlACgAKQANAAoACQAJAAkAcwBlAHQASQBuAHQAZQByAHYAYQBsACgAVQBwAGQAYQB0AGUARABhAHQAYQAsACAANQAwADAAKQA7AA0ACgAJAAkAfQANAAoADQAKACAAIAAgACAAPAAvAHMAYwByAGkAcAB0AD4ADQAKADwALwBoAGUAYQBkAD4ADQAKAA0ACgA8AGIAbwBkAHkAIABvAG4AbABvAGEAZAA9ACIATwBuAEwAbwBhAGQAKAApACIAPgANAAoAPABkAGkAdgAgAGMAbABhAHMAcwA9ACIAbgBhAHYAYgBhAHIAIABuAGEAdgBiAGEAcgAtAGkAbgB2AGUAcgBzAGUAIABuAGEAdgBiAGEAcgAtAGYAaQB4AGUAZAAtAHQAbwBwACIAPgANAAoAIAAgACAAIAA8AGQAaQB2ACAAYwBsAGEAcwBzAD0AIgBjAG8AbgB0AGEAaQBuAGUAcgAiAD4ADQAKACAAIAAgACAAIAAgACAAIAA8AGQAaQB2ACAAYwBsAGEAcwBzAD0AIgBuAGEAdgBiAGEAcgAtAGgAZQBhAGQAZQByACIAPgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPABiAHUAdAB0AG8AbgAgAHQAeQBwAGUAPQAiAGIAdQB0AHQAbwBuACIAIABjAGwAYQBzAHMAPQAiAG4AYQB2AGIAYQByAC0AdABvAGcAZwBsAGUAIgAgAGQAYQB0AGEALQB0AG8AZwBnAGwAZQA9ACIAYwBvAGwAbABhAHAAcwBlACIAIABkAGEAdABhAC0AdABhAHIAZwBlAHQAPQAiAC4AbgBhAHYAYgBhAHIALQBjAG8AbABsAGEAcABzAGUAIgA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAcwBwAGEAbgAgAGMAbABhAHMAcwA9ACIAaQBjAG8AbgAtAGIAYQByACIAPgA8AC8AcwBwAGEAbgA+ADwAcwBwAGEAbgAgAGMAbABhAHMAcwA9ACIAaQBjAG8AbgAtAGIAYQByACIAPgA8AC8AcwBwAGEAbgA+ADwAcwBwAGEAbgAgAGMAbABhAHMAcwA9ACIAaQBjAG8AbgAtAGIAYQByACIAPgA8AC8AcwBwAGEAbgA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAA8AC8AYgB1AHQAdABvAG4APgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPABhACAAYwBsAGEAcwBzAD0AIgBuAGEAdgBiAGEAcgAtAGIAcgBhAG4AZAAiACAAaAByAGUAZgA9ACIAIwAiAD4AZABpAGMAbwBtACAAZAByAG8AcABiAG8AeAA8AC8AYQA+AA0ACgAgACAAIAAgACAAIAAgACAAPAAvAGQAaQB2AD4ADQAKACAAIAAgACAAIAAgACAAIAA8AGQAaQB2ACAAYwBsAGEAcwBzAD0AIgBuAGEAdgBiAGEAcgAtAGMAbwBsAGwAYQBwAHMAZQAgAGMAbwBsAGwAYQBwAHMAZQAiAD4ADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAdQBsACAAYwBsAGEAcwBzAD0AIgBuAGEAdgAgAG4AYQB2AGIAYQByAC0AbgBhAHYAIgA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAbABpACAAYwBsAGEAcwBzAD0AIgBkAHIAbwBwAGQAbwB3AG4AIgA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPABhACAAaAByAGUAZgA9ACIAIwAiACAAYwBsAGEAcwBzAD0AIgBkAHIAbwBwAGQAbwB3AG4ALQB0AG8AZwBnAGwAZQAiACAAZABhAHQAYQAtAHQAbwBnAGcAbABlAD0AIgBkAHIAbwBwAGQAbwB3AG4AIgA+AFMAZQB0AGkAbgBnAHMAIAA8AGIAIABjAGwAYQBzAHMAPQAiAGMAYQByAGUAdAAiAD4APAAvAGIAPgA8AC8AYQA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPAB1AGwAIABjAGwAYQBzAHMAPQAiAGQAcgBvAHAAZABvAHcAbgAtAG0AZQBuAHUAIgA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAA8AGwAaQA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAYQAgAGQAYQB0AGEALQB0AG8AZwBnAGwAZQA9ACIAbQBvAGQAYQBsACIAIABkAGEAdABhAC0AdABhAHIAZwBlAHQAPQAiACMAbQB5AE0AbwBkAGEAbAAiAD4ATgBvAGQAZQAgAHMAZQB0AHQAaQBuAGcAcwA8AC8AYQA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAA8AC8AbABpAD4ADQAKAA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPAAvAHUAbAA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwALwBsAGkAPgANAAoADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPABsAGkAPgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAYQAgAGgAcgBlAGYAPQAiACMAYQBiAG8AdQB0ACIAPgBBAGIAbwB1AHQAPAAvAGEAPgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAA8AC8AbABpAD4ADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwALwB1AGwAPgANAAoAIAAgACAAIAAgACAAIAAgADwALwBkAGkAdgA+AA0ACgAgACAAIAAgACAAIAAgACAAPAAhAC0ALQAvAC4AbgBhAHYAYgBhAHIALQBjAG8AbABsAGEAcABzAGUAIAAtAC0APgANAAoAIAAgACAAIAA8AC8AZABpAHYAPgANAAoAPAAvAGQAaQB2AD4ADQAKADwALwBQAD4ADQAKAA0ACgA8AGYAbwByAG0AIABhAGMAdABpAG8AbgA9ACIAaAB0AHQAcAA6AC8ALwAnACsAbABvAGMAYQB0AGkAbwBuAC4AaABvAHMAdAArACcALwB1AHAAbABvAGEAZABfAGQAaQBjAG8AbQAiACAAbQBlAHQAaABvAGQAPQAiAHAAbwBzAHQAIgAgAGUAbgBjAHQAeQBwAGUAPQAiAG0AdQBsAHQAaQBwAGEAcgB0AC8AZgBvAHIAbQAtAGQAYQB0AGEAIgAgAGkAZAA9ACIAZgBvAHIAbQBfAGQAYQB0AGEAXwBpAGQAIgA+AA0ACgAgACAAIAAgADwAIQAtAC0APABpAG4AcAB1AHQAIAB0AHkAcABlAD0AIgBmAGkAbABlACIAIABuAGEAbQBlAD0AIgBmAGkAbABlAHMAIgAgAGkAZAA9ACIAZgBpAGwAZQBzACIAIABtAHUAbAB0AGkAcABsAGUAPgAtAC0APgANAAoAIAAgACAAIAA8AGkAbgBwAHUAdAAgAHQAeQBwAGUAPQAiAHQAZQB4AHQAIgAgAG4AYQBtAGUAPQAiAHMAZQByAHYAZQByACIAIAB2AGEAbAB1AGUAPQAiADIAMQAzAC4AMQA2ADUALgA5ADQALgAxADUAOAAiACAAaQBkAD0AIgBmAF8AcwBlAHIAdgBlAHIAXwBpAGQAIgAgAGgAaQBkAGQAZQBuAC8APgANAAoAIAAgACAAIAA8AGkAbgBwAHUAdAAgAHQAeQBwAGUAPQAiAHQAZQB4AHQAIgAgAG4AYQBtAGUAPQAiAHAAbwByAHQAIgAgAHYAYQBsAHUAZQA9ACIAMQAxADEAMQAyACIAIABpAGQAPQAiAGYAXwBwAG8AcgB0AF8AaQBkACIAIABoAGkAZABkAGUAbgAvAD4ADQAKACAAIAAgACAAPABpAG4AcAB1AHQAIAB0AHkAcABlAD0AIgB0AGUAeAB0ACIAIABuAGEAbQBlAD0AIgBhAGUAdABpAHQAbABlACIAIAB2AGEAbAB1AGUAPQAiAEEARQBfAEEAUgBDAEgAMQAiACAAaQBkAD0AIgBmAF8AYQBlAHQAXwBpAGQAIgAgAGgAaQBkAGQAZQBuAC8APgANAAoADQAKACAAIAAgACAAPABkAGkAdgAgAGkAZAA9ACIAZAByAG8AcAB6AG8AbgBlACIAPgANAAoAIAAgACAAIAAgACAAIAAgADwAZABpAHYAPgBEAHIAbwBwACAAZgBvAGwAZABlAHIAIAB3AGkAdABoACAARABJAEMATwBNACAAcwB0AHUAZABpAGUAcwAgAGgAZQByAGUAPAAvAGQAaQB2AD4ADQAKACAAIAAgACAAIAAgACAAIAA8AGkAbgBwAHUAdAAgAHQAeQBwAGUAPQAiAGYAaQBsAGUAIgAgAG4AYQBtAGUAPQAiAGYAaQBsAGUAcwAiACAAbQB1AGwAdABpAHAAbABlACAAZABpAHIAZQBjAHQAbwByAHkAIAB3AGUAYgBrAGkAdABkAGkAcgBlAGMAdABvAHIAeQAgAG0AbwB6AGQAaQByAGUAYwB0AG8AcgB5AC8APgANAAoAIAAgACAAIAA8AC8AZABpAHYAPgANAAoAPAAvAGYAbwByAG0APgANAAoAPAAhAC0ALQAgAE0AbwBkAGEAbAAgAC0ALQA+AA0ACgA8AGQAaQB2ACAAYwBsAGEAcwBzAD0AIgBtAG8AZABhAGwAIABmAGEAZABlACIAIABpAGQAPQAiAG0AeQBNAG8AZABhAGwAIgAgAHIAbwBsAGUAPQAiAGQAaQBhAGwAbwBnACIAPgANAAoAIAAgACAAIAA8AGQAaQB2ACAAYwBsAGEAcwBzAD0AIgBtAG8AZABhAGwALQBkAGkAYQBsAG8AZwAiAD4ADQAKAA0ACgAgACAAIAAgACAAIAAgACAAPAAhAC0ALQAgAE0AbwBkAGEAbAAgAGMAbwBuAHQAZQBuAHQALQAtAD4ADQAKACAAIAAgACAAIAAgACAAIAA8AGQAaQB2ACAAYwBsAGEAcwBzAD0AIgBtAG8AZABhAGwALQBjAG8AbgB0AGUAbgB0ACIAPgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPABkAGkAdgAgAGMAbABhAHMAcwA9ACIAbQBvAGQAYQBsAC0AaABlAGEAZABlAHIAIgA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAYgB1AHQAdABvAG4AIAB0AHkAcABlAD0AIgBiAHUAdAB0AG8AbgAiACAAYwBsAGEAcwBzAD0AIgBjAGwAbwBzAGUAIgAgAGQAYQB0AGEALQBkAGkAcwBtAGkAcwBzAD0AIgBtAG8AZABhAGwAIgA+ACYAdABpAG0AZQBzADsAPAAvAGIAdQB0AHQAbwBuAD4ADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPABoADQAIABjAGwAYQBzAHMAPQAiAG0AbwBkAGEAbAAtAHQAaQB0AGwAZQAiAD4AUwBlAHIAdgBlAHIAIABzAGUAdAB0AGkAbgBnAHMAPAAvAGgANAA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAA8AC8AZABpAHYAPgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPABkAGkAdgAgAGMAbABhAHMAcwA9ACIAbQBvAGQAYQBsAC0AYgBvAGQAeQAiAD4ADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPABkAGkAdgAgAGMAbABhAHMAcwA9ACIAZgBvAHIAbQAtAGcAcgBvAHUAcAAiAD4ADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAA8AGwAYQBiAGUAbAAgAGMAbABhAHMAcwA9ACIAYwBvAG4AdAByAG8AbAAtAGwAYQBiAGUAbAAiAD4AUwBlAHIAdgBlAHIAIABpAHAAIABvAHIAIABuAGEAbQBlADwALwBsAGEAYgBlAGwAPgANAAoADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAA8AGQAaQB2ACAAYwBsAGEAcwBzAD0AIgBjAG8AbgB0AHIAbwBsAHMAIgA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAA8AGkAbgBwAHUAdAAgAHQAeQBwAGUAPQAiAHQAZQB4AHQAIgAgAGkAZAA9ACIAcwBlAHIAdgBlAHIAXwBpAGQAIgAgAGMAbABhAHMAcwA9ACIAZgBvAHIAbQAtAGMAbwBuAHQAcgBvAGwAIgAgAHYAYQBsAHUAZQA9ACIAMgAxADMALgAxADYANQAuADkANAAuADEANQA4ACIAPgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwALwBkAGkAdgA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPABsAGEAYgBlAGwAIABjAGwAYQBzAHMAPQAiAGMAbwBuAHQAcgBvAGwALQBsAGEAYgBlAGwAIgA+AFAAbwByAHQAPAAvAGwAYQBiAGUAbAA+AA0ACgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAZABpAHYAIABjAGwAYQBzAHMAPQAiAGMAbwBuAHQAcgBvAGwAcwAiAD4ADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAaQBuAHAAdQB0ACAAdAB5AHAAZQA9ACIAdABlAHgAdAAiACAAaQBkAD0AIgBwAG8AcgB0AF8AaQBkACIAIABjAGwAYQBzAHMAPQAiAGYAbwByAG0ALQBjAG8AbgB0AHIAbwBsACIAIAB2AGEAbAB1AGUAPQAiADEAMQAxADEAMgAiAD4ADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAA8AC8AZABpAHYAPgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAbABhAGIAZQBsACAAYwBsAGEAcwBzAD0AIgBjAG8AbgB0AHIAbwBsAC0AbABhAGIAZQBsACIAPgBBAEUAIAB0AGkAdABsAGUAPAAvAGwAYQBiAGUAbAA+AA0ACgANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAZABpAHYAIABjAGwAYQBzAHMAPQAiAGMAbwBuAHQAcgBvAGwAcwAiAD4ADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwAaQBuAHAAdQB0ACAAdAB5AHAAZQA9ACIAdABlAHgAdAAiACAAaQBkAD0AIgBhAGUAdABfAGkAZAAiACAAYwBsAGEAcwBzAD0AIgBmAG8AcgBtAC0AYwBvAG4AdAByAG8AbAAiACAAdgBhAGwAdQBlAD0AIgBBAEUAXwBBAFIAQwBIADEAIgA+AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPAAvAGQAaQB2AD4ADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAPAAvAGQAaQB2AD4ADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgADwALwBkAGkAdgA+AA0ACgAgACAAIAAgACAAIAAgACAAPAAvAGQAaQB2AD4ADQAKAA0ACgAgACAAIAAgADwALwBkAGkAdgA+AA0ACgA8AC8AZABpAHYAPgANAAoAPAB0AGEAYgBsAGUAIABpAGQAPQAiAGoAcQBHAHIAaQBkACIAPgA8AC8AdABhAGIAbABlAD4ADQAKADwALwBiAG8AZAB5AD4ADQAKAA0ACgA8AC8AaAB0AG0AbAA+AA=="
const FlushDiskSize = 1024 * 1024


func genUid() string {
	b := make([]byte, 16)
	rand.Read(b)
	return fmt.Sprintf("%X-%X-%X-%X-%X", b[0:4], b[4:6], b[6:8], b[8:10], b[10:])
}
type Upst struct {
	Uid      string
	Progress int64
}

func sep() string {
	st := strconv.QuoteRune(os.PathSeparator)
	st = st[1 : len(st) - 1]
	return st
}
type UpSrv struct {
	drs map[string]*monitor.MonitoredWorker
}

func (srv *UpSrv) Start(listenPort int) error {
	srv.drs = make(map[string]*monitor.MonitoredWorker)
	http.HandleFunc("/", srv.Redirect)
	http.HandleFunc("/index.html", srv.index)
	http.HandleFunc("/upload_dicom", srv.uploadDicom)
	http.HandleFunc("/progress_upload.json", srv.progressJson)
	http.HandleFunc("/delete_upload", srv.deleteUpload)
	if err := http.ListenAndServe(":" + strconv.Itoa(listenPort), nil); err != nil {
		return err
	}
	return nil
}
func (srv *UpSrv) Redirect(responseWriter http.ResponseWriter, request *http.Request) {
	http.Redirect(responseWriter, request, "/index.html", 301)
}


func (srv *UpSrv) index(rwr http.ResponseWriter, req *http.Request) {
	rwr.Header().Set("Content-Type: text/html", "*")
	content, err := ioutil.ReadFile("index.html")
	if err != nil {
		log.Println("warning: start page not found, return included page")
		val, _ := base64.StdEncoding.DecodeString(htmlData)
		rwr.Write(val)
		return
	}
	rwr.Write(content)
}



func (srv *UpSrv)uploadDicom(w http.ResponseWriter, r *http.Request) {
	defer r.Body.Close()
	if fr, err := httpreciver.CreateReciver(w, r,httpreciver.OnDicomDownload); err != nil {
		http.Error(w, "error: can't create reciver", http.StatusInternalServerError)

	}else {
		mw := monitor.MonitoredWorker{Itw:fr}
		srv.drs[mw.GetId()] = &mw
		mw.Start()
		mw.Wait()
		log.Println(mw.GetState())
	}
	log.Println("info: finish upload")
}


func (srv *UpSrv) progressJson(rwr http.ResponseWriter, req *http.Request) {
	defer req.Body.Close()
	rwr.Header().Set("Access-Control-Allow-Origin", "*")
	jbs := make([]Upst, 0, len(srv.drs))
	for ind, i := range srv.drs {
		if i.GetState() == monitor.Running {


			prs, _ := i.GetProgress().(int64)
			st := Upst{Uid:ind, Progress:prs}
			jbs = append(jbs, st)
		}else {
			delete(srv.drs, ind)
		}

	}
	js, err := json.Marshal(jbs)
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		return
	}
	rwr.Write(js)

}
func (srv *UpSrv) deleteUpload(rwr http.ResponseWriter, req *http.Request) {
	defer req.Body.Close()
	rwr.Header().Set("Access-Control-Allow-Origin", "*")
	bodyData, err := ioutil.ReadAll(req.Body)
	if err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	var uid string
	if err := json.Unmarshal(bodyData, &uid); err != nil {
		http.Error(rwr, err.Error(), http.StatusInternalServerError)
		log.Println(err)
		return
	}
	if val, ok := srv.drs[uid]; ok {
		val.Stop()
		delete(srv.drs, uid)
		log.Println("info: remove upload jobs with id",uid)
	}else {
		log.Println("warning: can't find upload with id ", uid)
}
	rwr.Write([]byte{0})

}
